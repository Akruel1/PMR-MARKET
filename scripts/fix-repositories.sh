#!/bin/bash

# üîß –°–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏ Ubuntu
# –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å PPA –∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏

set -e

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

print_status() {
    echo -e "${GREEN}[INFO]${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

print_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏ Ubuntu"
echo "=============================================="

# –®–∞–≥ 1: –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
print_status "–ü–æ–∏—Å–∫ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤..."

# –£–¥–∞–ª–µ–Ω–∏–µ Litecoin PPA
if ls /etc/apt/sources.list.d/*litecoin* 1> /dev/null 2>&1; then
    print_warning "–ù–∞–π–¥–µ–Ω –ø—Ä–æ–±–ª–µ–º–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Litecoin, —É–¥–∞–ª—è–µ–º..."
    sudo rm -f /etc/apt/sources.list.d/*litecoin*
    print_status "–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Litecoin —É–¥–∞–ª–µ–Ω"
else
    print_status "–ü—Ä–æ–±–ª–µ–º–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Litecoin –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

# –ü–æ–∏—Å–∫ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö PPA
print_status "–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä—É–≥–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏..."

# –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ sources.list.d
if ls /etc/apt/sources.list.d/*.list 1> /dev/null 2>&1; then
    echo "–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:"
    ls -la /etc/apt/sources.list.d/*.list
fi

# –®–∞–≥ 2: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ apt
print_status "–û—á–∏—â–∞–µ–º –∫—ç—à apt..."
sudo apt clean
sudo apt autoclean

# –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–∞–∫–µ—Ç–æ–≤
print_status "–û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤..."
if sudo apt update; then
    print_status "–°–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω"
else
    print_error "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –ø–∞–∫–µ—Ç–æ–≤"
    echo "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å: sudo apt update --fix-missing"
    exit 1
fi

# –®–∞–≥ 4: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ–º–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
print_status "–ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Å–ª–æ–º–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã..."
sudo apt --fix-broken install -y

# –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
print_status "–û–±–Ω–æ–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º—É..."
sudo apt upgrade -y

print_status "‚úÖ –ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!"
print_status "–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É Node.js 20.x"

echo ""
echo "–°–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Node.js 20.x:"
echo "curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -"
echo "sudo apt-get install -y nodejs"
